document.addEventListener("DOMContentLoaded",()=>{let e={scrollOffset:100,scrollDuration:800,testimonialInterval:7e3,notificationDuration:4e3},t={menuToggle:document.querySelector(".menu-toggle"),nav:document.querySelector(".nav"),navbar:document.querySelector(".navbar"),contactForm:document.querySelector(".contact-form"),testimonials:document.querySelectorAll(".testimonial"),scrollTopBtn:document.querySelector(".scroll-to-top"),internalLinks:document.querySelectorAll('a[href^="#"]')},n={debounce:(e,t)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,r),t)}},throttle:(e,t)=>{let n,r;return(...a)=>{r?(clearTimeout(n),n=setTimeout(()=>{Date.now()-r>=t&&(e.apply(this,a),r=Date.now())},t-(Date.now()-r))):(e.apply(this,a),r=Date.now())}}},r=()=>{t.internalLinks.forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();let r=e.getAttribute("href"),l=document.querySelector(r);if(l){t.nav&&t.nav.classList.contains("active")&&a();let o=l.getBoundingClientRect().top+window.pageYOffset,i=o-(t.navbar?t.navbar.offsetHeight:0);window.scrollTo({top:i,behavior:"smooth"}),history.pushState?history.pushState(null,null,r):location.hash=r}})})},a=()=>{if(!t.menuToggle||!t.nav)return;let e="true"===t.menuToggle.getAttribute("aria-expanded");t.menuToggle.setAttribute("aria-expanded",!e),t.menuToggle.classList.toggle("active"),t.nav.classList.toggle("active"),document.body.style.overflow=e?"":"hidden"},l=()=>{t.menuToggle&&t.nav&&(t.menuToggle.setAttribute("aria-label","Men\xfa de navegaci\xf3n"),t.menuToggle.setAttribute("aria-expanded","false"),t.menuToggle.setAttribute("aria-controls","nav"),t.menuToggle.addEventListener("click",a),t.nav.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{t.nav.classList.contains("active")&&a()})}))},o=n.throttle(()=>{t.navbar&&(window.scrollY>50?t.navbar.classList.add("scrolled"):t.navbar.classList.remove("scrolled"))},100),i=e=>{let t=!0,n=e.querySelectorAll("input, textarea, select");return n.forEach(e=>{let n=document.createElement("span");n.className="error-message",n.setAttribute("aria-live","polite");let r=e.nextElementSibling;r&&r.classList.contains("error-message")&&r.remove(),e.required&&!e.value.trim()?(e.classList.add("error"),n.textContent="Este campo es obligatorio",e.insertAdjacentElement("afterend",n),t=!1):"email"!==e.type||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)?e.classList.remove("error"):(e.classList.add("error"),n.textContent="Por favor, introduce un email v\xe1lido",e.insertAdjacentElement("afterend",n),t=!1)}),t},s=()=>{t.contactForm&&(t.contactForm.addEventListener("submit",e=>{if(e.preventDefault(),i(t.contactForm)){let n=t.contactForm.querySelector('button[type="submit"]'),r=n.textContent;n.disabled=!0,n.textContent="Enviando...",setTimeout(()=>{t.contactForm.reset(),n.textContent=r,n.disabled=!1,u("Gracias por tu mensaje. Nos pondremos en contacto contigo pronto.")},1500)}}),t.contactForm.querySelectorAll('input[type="email"]').forEach(e=>{e.addEventListener("blur",()=>i(t.contactForm))}))},c=()=>{if(!t.testimonials||t.testimonials.length<=1)return;let n=0,r=t.testimonials.length,a=e=>{t.testimonials.forEach((t,n)=>{t.classList.toggle("active",n===e),t.setAttribute("aria-hidden",n!==e)})},l=()=>{a(n=(n+1)%r)},o=()=>{let e=document.createElement("div");e.className="testimonial-controls";let o=document.createElement("button");o.className="testimonial-prev",o.innerHTML="&lt;",o.setAttribute("aria-label","Testimonio anterior");let i=document.createElement("button");i.className="testimonial-next",i.innerHTML="&gt;",i.setAttribute("aria-label","Siguiente testimonio"),o.addEventListener("click",()=>{a(n=(n-1+r)%r),c()}),i.addEventListener("click",()=>{l(),c()}),e.appendChild(o),e.appendChild(i),t.testimonials[0].parentNode.appendChild(e)},i,s=()=>{i=setInterval(l,e.testimonialInterval)},c=()=>{clearInterval(i),s()};a(0),o(),s();let d=t.testimonials[0].parentNode;d.addEventListener("mouseenter",()=>clearInterval(i)),d.addEventListener("mouseleave",s)},d=()=>{let e=document.querySelectorAll(".fade-in, .slide-in, .zoom-in");if(!e.length)return;let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("visible"),t.unobserve(e.target))})},{threshold:.1,rootMargin:"0px 0px -100px 0px"});e.forEach(e=>{t.observe(e)})},u=(t,n="success")=>{let r=document.createElement("div");r.className=`notification ${n}`,r.setAttribute("role","alert"),r.setAttribute("aria-live","assertive"),r.innerHTML=`
      <p>${t}</p>
      <button class="notification-close" aria-label="Cerrar notificaci\xf3n">&times;</button>
    `,document.body.appendChild(r),setTimeout(()=>r.classList.add("visible"),10),r.querySelector(".notification-close").addEventListener("click",()=>{m(r)});let a=setTimeout(()=>m(r),e.notificationDuration);r.addEventListener("mouseenter",()=>clearTimeout(a)),r.addEventListener("mouseleave",()=>{setTimeout(()=>m(r),e.notificationDuration)})},m=e=>{e.classList.remove("visible"),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},300)},v=()=>{if(!t.scrollTopBtn)return;let e=()=>{let e=window.scrollY>300;t.scrollTopBtn.style.display=e?"block":"none",t.scrollTopBtn.setAttribute("aria-hidden",!e)};t.scrollTopBtn.setAttribute("aria-label","Volver arriba"),t.scrollTopBtn.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"}),t.scrollTopBtn.blur()}),window.addEventListener("scroll",n.throttle(e,200)),e()},b=()=>{let e=document.querySelectorAll("img[data-src]");if(!e.length)return;let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){let n=e.target;n.src=n.getAttribute("data-src"),n.removeAttribute("data-src"),t.unobserve(n)}})});e.forEach(e=>t.observe(e))},p=()=>{r(),l(),s(),c(),d(),v(),b(),window.addEventListener("scroll",o),o()};p()});